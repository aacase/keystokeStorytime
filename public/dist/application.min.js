"use strict";var ApplicationConfiguration=function(){var applicationModuleName="keystoke-storytime",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("stories"),ApplicationConfiguration.registerModule("users"),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function($scope,Authentication,Menus){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),angular.module("stories").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Stories","stories","dropdown","/stories(/create)?"),Menus.addSubMenuItem("topbar","stories","List Stories","stories"),Menus.addSubMenuItem("topbar","stories","New Story","stories/create")}]),angular.module("stories").config(["$stateProvider",function($stateProvider){$stateProvider.state("listStories",{url:"/stories",templateUrl:"modules/stories/views/list-stories.client.view.html"}).state("createStory",{url:"/stories/create",templateUrl:"modules/stories/views/create-story.client.view.html"}).state("viewStory",{url:"/stories/:storyId",templateUrl:"modules/stories/views/view-story.client.view.html"}).state("editStory",{url:"/stories/:storyId/edit",templateUrl:"modules/stories/views/edit-story.client.view.html"})}]),angular.module("stories").controller("StoriesController",["$scope","$stateParams","$location","Authentication","Stories",function($scope,$stateParams,$location,Authentication,Stories){$scope.authentication=Authentication,$scope.counter=0,$scope.counterUp=function(){$scope.counter+=1},$scope.counterDown=function(){$scope.counter=$scope.counter-1},$scope.create=function(){var story=new Stories({name:this.name,firstName:this.firstName,dog:this.dog,superHero:this.superHero,continent:this.continent,content:"So there you are, yeah you, "+this.firstName+" 				. Just minding your business, walking that awesome pooch of yours, "+this.dog+"				. It's a lovely day and you are spending it taking in the scenery at the hike and				 bike trail by the river. All of the sudden, you hear a loud bang, and all hell 				 starts to break loose. You hear another loud boom, and then...it all goes black",content2:"",content3:"It's at this point that you realize something isn't right. Yep. 				 Those colege psych classes taught you enough to realize that you're just 				 having a weird dream. Upon this realization, you wake up safe and sound in your bed.				  That loud boom you heard? Yeah, that's your neighbor playing Call of Duty. 				  That vision of waking up in "+this.continent+" You've got a business trip coming up.				   Probably just nerves. "+this.superHero+"? You were reading that comic before bed. 				   And "+this.dog+"? He's sleeping peacefully at your feet. You realize it's Monday 				   morning and the weekend is over. That's the real nightmare."});"Asia"==story.continent?story.content2="You come to after feeling a strange liquid falling on your cheek. 					In your groggy state, you look up and see...Uh oh. This is bad. It's Godzilla!					 And he doesn't look happy. Wait a second...did Godzilla just drool on you? 					 That's gross. You see his massive feet about to make you a human pancake,					  when all of the sudden, a monster sized version 					  of "+story.superHero+" punches Godzilla in the face! 					  This is kinda weird, you think. ":"Europe"==story.continent?story.content2="You come to after feeling a strange liquid falling on your cheek. In 				your groggy state, you look up and see...a leaky barrel of wine. You stand up 				and walk out the nearest door, and you're suddenly on the streets of Paris! 				This is way better than when you blacked out a second ago. You walk over 				to a cafe and order some coffee. You reach into your wallet for some cash and 				come up empty. Dang. But what's this? "+story.superHero+" 				taps on your shoulder, and says he's got you covered. That's kinda weird, but you decide to roll with it.":"North America"==story.continent?story.content2="You come to after hearing a crowd of people chanting 'Let's go Cowboys!'. 				You realize that you're on the 50 yard line of thier stadium, and a massive group of 				football players are running towards you at a high rate of speed. Just before your're 				about to be obliterated,"+story.superHero+" yanks you out of the way. 'You need to be 				more careful,'"+story.superHero+" says.":"South America"==story.continent?story.content2="You come to after feeling a strange liquid falling on your cheek. 				In your groggy state, you look up and see...no it can't be. A Giant Sloth? And he's 				drooling on you? Where the heck are you? You look around and see a sign off in the 				distance. It says 'Sao Paulo 1000km.' You haven't woken up in a place this strange				 since college. All of the sudden, a team of loggers come through the brush in their 				 heavy machinery, hellbent on destroying everything they can. Just when their giant chainsawmobile				  is about to gobble you up, "+story.superHero+" comes to the rescue, pulling you to safety. ":"Antarctica"==story.continent?story.content2="You picked Antarctica? There's literally nothing here. You feel yourself freezing to death.				Even "+story.superHero+" can't save you now.":"Africa"==story.continent?story.content2="You come to after feeling a strange liquid falling on your cheek. In your 				groggy state, you look up and see...a pack of lions drooling over thier next meal. '				I wonder what I taste like,'' you think, before realizing that you're about to be ancient history.				 You try to slowly get up, not wanting to attract any more attention from those scary dudes. 				 It doesn't work, and they start to pounce. Just when you think you've taken your last breath,				 "+story.superHero+" comes in and saves the day! What the heck is he doing in Africa? Oh well. You're alive!":"Australia"==story.continent&&(story.content2=" You come to after feeling a strange liquid falling on your cheek.				 In your groggy state, you look up and see...no it can't be. A kangaroo? 				 Where the heck are you? You look around and see a sign off in the distance. 				 It says 'Sydney 1000km.' You haven't woken up in a place this strange since 				 college. You turn to your right, and you see the biggest spider you've ever 				 seen. Just as it's about to sink its fangs into you, "+story.superHero+"				  yanks you out of the way. What the heck is going on here?"),story.$save(function(response){$location.path("stories/"+response._id),$scope.name="",$scope.firstName="",$scope.dog="",$scope.superHero="",$scope.continent=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(story){if(story){story.$remove();for(var i in $scope.stories)$scope.stories[i]===story&&$scope.stories.splice(i,1)}else $scope.story.$remove(function(){$location.path("stories")})},$scope.update=function(){var story=$scope.story;story.$update(function(){$location.path("stories/"+story._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.stories=Stories.query()},$scope.findOne=function(){$scope.story=Stories.get({storyId:$stateParams.storyId})}}]),angular.module("stories").factory("Stories",["$resource",function($resource){return $resource("stories/:storyId",{storyId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invlaid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http.delete("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);